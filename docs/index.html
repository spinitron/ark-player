<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Ark Player widget demo</title>

<!-- Copyright Spinitron LLC -->
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at https://mozilla.org/MPL/2.0/. -->
       <style>
            html {
                color: #222;
                font-size: 1em;
                line-height: 1.4;
                color: #2d2d2d;
            }
            ::-moz-selection {
                background: #b3d4fc;
                text-shadow: none;
            }
            ::selection {
                background: #b3d4fc;
                text-shadow: none;
            }
            audio,
            canvas,
            iframe,
            img,
            svg,
            video {
                vertical-align: middle;
            }

            body {
                font-family: sans-serif;
                margin: 0 auto;
                max-width: 60rem;
            }

            .page_container {
                width: 98%;
                max-width: 65rem;
                margin: 1em auto 4em;
            }

            h1,
            h2,
            h3 {
                margin: 2em 0 0;
            }
            p {
                margin: 1em 0;
            }
            aside {
                margin: 1em;
                color: #666;
                font-size: 95%;
                padding-left: 0.5em;
                border-left: 2px solid #ccc;
            }
            .ark-play-button,
            a,
            a:visited {
                color: blue;
                cursor: pointer;
            }
            code,
            tt {
                margin: 0 2px;
                padding: 0 0.3em;
                white-space: nowrap;
                border: 1px solid #eaeaea;
                background-color: #f8f8f8;
                border-radius: 3px;
                font-family: Monaco, Consolas, monospace;
                font-size: 0.85em;
                color: #333;
            }
            pre > code {
                margin: 0;
                padding: 0;
                white-space: pre;
                border: 0;
                background: transparent;
            }
            pre {
                font-family: monospace, monospace;
                font-size: 1em;
                background-color: #f8f8f8;
                border: 1px solid #ccc;
                line-height: 1.5;
                overflow: auto;
                padding: 0.3em 0.6em;
                border-radius: 3px;
            }

            pre code {
                background-color: transparent;
                border: 0;
            }
            ul,
            ol {
                margin: 1em 0;
                padding: 0 0 0 2em;
            }
            .ark-play-button img {
                display: inline;
            }
        </style>

        <script src="https://cdn.jsdelivr.net/gh/spinitron/ark-player@latest/dist/arkPlayer.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/spinitron/ark-player@latest/dist/arkPlayer.css">

        <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    </head>
    <body>
        <div class="page_container">
            <h1>Ark Player widget</h1>

            <p>Demo page for Spinitron Ark Player widget, with instructions.</p>

            <p>
                Github repo with the widget and this page:
                <a href="https://github.com/spinitron/ark-player">spinitron/ark-player</a>
            </p>

            <div>
                <label for="station-select">Choose a station</label>

                <select class="ark_player_demo select_station" id="station-select">
                    <option name="stations">-- Choose a station --</option>
                    <option value="KAFM" data-timezone="America/Denver">KAFM</option>
                    <option value="KAOS" data-timezone="America/Los_Angeles">KAOS</option>
                    <option value="KBCS" data-timezone="America/Los_Angeles">KBCS</option>
                    <option value="KCSB" data-timezone="America/Los_Angeles">KCSB</option>
                    <option value="KCSM" data-timezone="America/Los_Angeles">KCSM</option>
                    <option value="KDUR" data-timezone="America/Denver">KDUR</option>
                    <option value="KGLP" data-timezone="America/Denver">KGLP</option>
                    <option value="KKUP" data-timezone="America/Los_Angeles">KKUP</option>
                    <option value="KMUZ" data-timezone="America/Los_Angeles">KMUZ</option>
                    <option value="KNON" data-timezone="America/Chicago">KNON</option>
                    <option value="KNSJ" data-timezone="America/Los_Angeles">KNSJ</option>
                    <option value="KOPN" data-timezone="America/Chicago">KOPN</option>
                    <option value="KOTO" data-timezone="America/Denver">KOTO</option>
                    <option value="KPOO" data-timezone="America/Los_Angeles">KPOO</option>
                    <option value="KPTZ" data-timezone="America/Los_Angeles">KPTZ</option>
                    <option value="KSJD" data-timezone="America/Denver">KSJD</option>
                    <option value="KSPC" data-timezone="America/Los_Angeles">KSPC</option>
                    <option value="KSYM" data-timezone="America/Chicago">KSYM</option>
                    <option value="KTNA" data-timezone="America/Anchorage">KTNA</option>
                    <option value="KURU" data-timezone="America/Denver">KURU</option>
                    <option value="KVCU" data-timezone="America/Denver">KVCU</option>
                    <option value="KVRF" data-timezone="America/Anchorage">KVRF</option>
                    <option value="KXCI" data-timezone="America/Phoenix">KXCI</option>
                    <option value="KZFR" data-timezone="America/Los_Angeles">KZFR</option>
                    <option value="KZMU" data-timezone="America/Denver">KZMU</option>
                    <option value="KZSC" data-timezone="America/Los_Angeles">KZSC</option>
                    <option value="WCOM" data-timezone="America/New_York">WCOM</option>
                    <option value="WCUW" data-timezone="America/New_York">WCUW</option>
                    <option value="WDNA" data-timezone="America/New_York">WDNA</option>
                    <option value="WEFT" data-timezone="America/Chicago">WEFT</option>
                    <option value="WELT" data-timezone="America/New_York">WELT</option>
                    <option value="WERA" data-timezone="America/New_York">WERA</option>
                    <option value="WERU" data-timezone="America/New_York">WERU</option>
                    <option value="WESS" data-timezone="America/New_York">WESS</option>
                    <option value="WEVL" data-timezone="America/Chicago">WEVL</option>
                    <option value="WFHB" data-timezone="America/New_York">WFHB</option>
                    <option value="WFNU" data-timezone="America/Chicago">WFNU</option>
                    <option value="WHCP" data-timezone="America/New_York">WHCP</option>
                    <option value="WMMT" data-timezone="America/New_York">WMMT</option>
                    <option value="WMRW" data-timezone="America/New_York">WMRW</option>
                    <option value="WNMC" data-timezone="America/New_York">WNMC</option>
                    <option value="WOWD" data-timezone="America/New_York">WOWD</option>
                    <option value="WQSV" data-timezone="America/New_York">WQSV</option>
                    <option value="WRFI" data-timezone="America/New_York">WRFI</option>
                    <option value="WSCA" data-timezone="America/New_York">WSCA</option>
                    <option value="WTIP" data-timezone="America/Chicago">WTIP</option>
                    <option value="WUML" data-timezone="America/New_York">WUML</option>
                    <option value="WVEW" data-timezone="America/New_York">WVEW</option>
                    <option value="WXNA" data-timezone="America/Chicago">WXNA</option>
                    <option value="WXOX" data-timezone="America/New_York">WXOX</option>
                    <option value="WXPR" data-timezone="America/Chicago">WXPR</option>
                    <option value="WZBC" data-timezone="America/New_York">WZBC</option>
                </select>
            </div>

            <!-- WIDGET MARKUP - the Ark Player widget markup. Copy-paste this to END OF WIDGET MARKUP -->
            <div class="ark-player" id="ark-player">
                <audio class="ark-player__media-element" width="1" height="1"></audio>
                <div class="ark-player__control">
                    <button class="ark-player__play" aria-label="Play (k)" title="Play (k)">
                        <svg width="100%" height="100%" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1576 927l-1328 738q-23 13-39.5 3t-16.5-36v-1472q0-26 16.5-36t39.5 3l1328 738q23 13 23 31t-23 31z" />
                        </svg>
                    </button>
                    <button class="ark-player__pause ark-player_hide" aria-label="Pause (k)" title="Play (k)">
                        <svg width="100%" height="100%" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1664 192v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45zm-896 0v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45z" />
                        </svg>
                    </button>
                </div>

                <div class="ark-player__volume-control">
                    <button class="ark-player__mute-button" aria-label="Mute (m)" title="Mute (m)">
                        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">
                            <path class="ark-player__volume-speaker" d="M8,21 L12,21 L17,26 L17,10 L12,15 L8,15 L8,21 Z M19,14 L19,22 C20.48,21.32 21.5,19.77 21.5,18 C21.5,16.26 20.48,14.74 19,14 ZM19,11.29 C21.89,12.15 24,14.83 24,18 C24,21.17 21.89,23.85 19,24.71 L19,26.77 C23.01,25.86 26,22.28 26,18 C26,13.72 23.01,10.14 19,9.23 L19,11.29 Z"></path>
                            <path class="ark-player__volume-slash" d="M 9.25,9 7.98,10.27 24.71,27 l 1.27,-1.27 Z" style="display: none;"></path>
                        </svg>
                    </button>
                    <div class="ark-player__volume-area"><input class="ark-player__volume-slider" type="range" min="0" max="100" value="100" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100" aria-valuetext="100% volume"></div>
                </div>

                <div class="ark-player__picker">
                    <div class="ark-player__date">
                        <select name="date" class="select-css"></select>
                    </div>

                    <div class="ark-player__time">
                        <select name="hours" class="select-css"></select>
                        <select name="minutes" class="select-css"></select>
                    </div>
                </div>

                <div class="ark-player__status ark-player_hide">
                    <div class="ark-player__date">--/--/--</div>
                    <div class="ark-player__time">-:--:-- --</div>
                </div>
                <div class="ark-player__mode-hint"></div>
            </div>
            <!-- END OF WIDGET MARKUP -->

            <div><br><h4 class="available-audio-heading" style="display:none">Available audio in this archive</h4></div>
            <div class="ark-audio-availability"></div>
            <script>
                (() => {
                    const searchParams = new URLSearchParams(window.location.search);
                    const stationName = searchParams.get('station');
                    if (stationName.match(/^[a-zA-Z][a-zA-Z0-9-]+[a-zA-Z0-9]$/)) {
                        var availAjaxRequest = new XMLHttpRequest();
                        availAjaxRequest.addEventListener("load", (event) => {
                            document.querySelector('.ark-audio-availability').innerHTML = availAjaxRequest.responseText;
                            document.querySelector('.available-audio-heading').style = 'display:initial;margin: 1.5em 0 0;';
                        });
                        availAjaxRequest.open("GET", `https://ark3.spinitron.com/cgi/avail-frag/?station=${stationName}`);
                        availAjaxRequest.send();
                    }
                })();
            </script>

            <p>The Ark Player widget has these parts that you should integrate into your web pages separately.</p>

            <ol>
                <li>Links to the Ark Player's JavaScript and CSS assets</li>
                <li>The Ark Player markup</li>
                <li>Optional start links/buttons</li>
                <li>JavaScript that initializes the player</li>
            </ol>


            <h2>1. Asset links</h2>

            <p>
                The Ark Player requires a JavaScript file and a CSS file. You can put links to the files in the
                spinitron/ark-player Github repo.
                <a href="https://github.com/spinitron/ark-player/blob/main/docs/index.html#L113-L115">This page</a> uses
                the following asset links that you can also use.
            </p>

            <pre><code>&lt;script src="https://cdn.jsdelivr.net/gh/spinitron/ark-player@latest/dist/arkPlayer.js"&gt;&lt;/script&gt;
&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/spinitron/ark-player@latest/dist/arkPlayer.css"&gt;</code></pre>

            <p>
                Alternatively you can copy the files from the <code>dist</code> directory of this repo into your web
                site and link your copies. If you are using NPM in your work then you can install the
                <a href="https://www.npmjs.com/package/ark-player">ark-player NPM package</a>. Or you can fork this repo
                and make your own version.
            </p>

            <aside>
                (If you want to change anything in the player's JavaScript or Styles then be prepared to distribute your
                changes since we chose
                <a href="https://choosealicense.com/licenses/mpl-2.0/">Mozilla Public License 2.0</a> for this work. See
                the project README for development and contribution instructions.)
            </aside>

            <h2>2. Ark Player markup</h2>

            <p>
                The markup is a chunk of HTML for the Ark Player's user interface. Copy it from the
                <a href="https://github.com/spinitron/ark-player/blob/main/docs/index.html#L191-L232"
                    >source of this page</a
                >. The part to copy is indicated in HTML comments.
            </p>

            <p>
                The opening <code>&lt;div&gt;</code> has an optional <code>data-ark-start</code> attribute with a value
                that controls the player's start date-time on page load. For example, if the opening tag is like this
            </p>

            <pre><code>&lt;div class="ark-player" id="ark-player" data-ark-start="20201020T100000Z"&gt;</code></pre>

            <p>
                then the player initializes itself so the play button starts from 20201020T100000Z, i.e. 10:00 UTC on
                Oct 20th 2020. Set a suitable value or remove the attribute.
            </p>

            <h2>3. Start links/buttons</h2>

            <p>
                You can put links, buttons, icons, or other elements on a page so that when the user clicks or touches
                them, the Ark Player starts playing at a specific date and time. Any visible element with a
                <code>data-ark-start</code> attribute with valid date-timestamp value becomes click/touchable. The
                date-time must be in UTC and formatted as <code>yyyymmddThhmmssZ</code>. For example
            </p>

            <pre><code>&lt;div data-ark-start="20201020T180000Z"&gt;Click me!&lt;/div&gt;</code></pre>

            <p>
                This makes a block on the page and if the user clicks or touches it then the Ark Player starts playing
                that archive beginning at 18:00:00 UTC on Oct 20th 2020. (It doesn't need to be a
                <code>&lt;div&gt;</code>. Most visible elements should do.) Here are three examples with
                <a href="https://github.com/spinitron/ark-player/blob/main/docs/index.html#L331-L360"
                    >source code here</a>.
            </p>

            <ul>
                <!-- EXAMPLE LINKS - you need to update them (automatically or otherwise) because the archive is only 2 weeks -->
                <li>
                    <a class="ark-play-button" data-ark-start="20201020T180000Z"
                        ><img
                            src="https://cdn.jsdelivr.net/npm/ark-player@2/dist/loudspeaker.svg"
                            alt="Start archive player"
                            width="24"
                            height="24"
                    /></a>
                    Start the archive at such-and-such date and time
                </li>
                <li>
                    <a class="ark-play-button" data-ark-start="20201020T170000Z"
                        ><img
                            src="https://cdn.jsdelivr.net/npm/ark-player@2/dist/loudspeaker.svg"
                            alt="Start archive player"
                            width="24"
                            height="24"
                    /></a>
                    Start at some other date and time
                </li>
                <li>
                    <a class="ark-play-button" data-ark-start="20201020T160000Z"
                        ><img
                            src="https://cdn.jsdelivr.net/npm/ark-player@2/dist/loudspeaker.svg"
                            alt="Start archive player"
                            width="24"
                            height="24"
                    /></a>
                    Start at yet another date and time
                </li>
            </ul>

            <p>
                <strong>NOTE</strong> These examples don't work because they already expired. Archives are available
                only for programing date-times between two weeks ago and about an hour ago relative when a listener
                visits your web page. Static values for <code>data-ark-start</code> attributes will therefore stop
                working after at most two weeks. It's more practical to use dynamic values, that is, to automate
                generation of date-time values for <code>data-ark-start</code> using a script.
            </p>

            <h2>4. Initialization JavaScript</h2>

            <p>
                Somewhere on the page you need to put initialization JavaScript. It's a small bit of code in
                <code>&lt;script&gt;</code> tags. The exact code you need must be configured for your station. Contact
                Spinitron to get the specific code for your station.
            </p>

            <p>
                View the
                <a href="https://github.com/spinitron/ark-player/blob/main/docs/index.html#L402-L422">source of this page</a>
                to see an example.
            </p>

            <script>
                document.querySelector('.ark_player_demo.select_station').addEventListener('change', (event) => {
                    const selection = event.target.selectedOptions[0];
                    window.location.replace(
                        `${window.location.origin}${window.location.pathname}?station=${selection.value}&zone=${selection.dataset.timezone}`,
                    );
                });

                const searchParams = new URLSearchParams(window.location.search);
                const stationName = searchParams.get('station');
                const timeZone = searchParams.get('zone');
                document.querySelector('.ark_player_demo.select_station').value = stationName;
            </script>

            <!-- INITIALIZATION JAVASCRIPT - Use a version of this in your web pages modified for your station -->
            <script>
                // todo initialize widget with data attributes on the #ark-player element, then the script loading can be non-blocking (async)
                window.ark2Player(document.getElementById('ark-player'), {
                    hlsBaseUrl: 'https://ark3.spinitron.com/ark2',
                    stationName: stationName,
                    // display player controls and status in this zone. should normally be the station zone.
                    // NOTE some older browsers don't support it in which case the player uses the client's zone
                    timeZone: timeZone,
                    // enables writing to the browser console
                    enableDebug: true,
                    mediaSessionMetadata: {
                        title: stationName + ' archive player',
                        artist: 'Webcast wayback machine',
                        album: 'Album blah',
                        artwork: [
                            {
                                src: 'https://spinitron.com/images/Station/18-img_logo.225x225.png?v=1512677078',
                                sizes: '170x51',
                                type: 'image/png',
                            },
                        ],
                    },
                });
            </script>
            <!-- END OF INITIALIZATION JAVASCRIPT -->
        </div>
    </body>
</html>
